{% extends 'ccvo/base.html' %}
{% load static %}
{% block extra_css %} 
<link rel="stylesheet" href="{% static 'core/styles/ccvo/add_service_record_page.css' %}">
{% endblock extra_css %}
<title>{% block title %}Add Service Record{% endblock %}</title>

{% block content %}
<div class="container py-5">
    <div class="arrow-back mb-4">
                    <a href="{% url 'services-page' %}" class="arrow-back">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </a>
                
                </div>


                            {% if messages %}
  {% for message in messages %}
    {% if "logged in" not in message.message|lower %}
      <div class="alert 
          {% if message.tags == 'error' %}alert-danger
          {% elif message.tags == 'success' %}alert-success
          {% elif message.tags == 'warning' %}alert-warning
          {% else %}alert-info
          {% endif %}">
        {{ message }}
      </div>
    {% endif %}
  {% endfor %}
{% endif %}
    <!-- Search Client Section -->
    <div class="text-center search-pet-container rounded mb-5 p-4">
      <h5 class=" mb-3  font-weight-bold">üîç Pet</h5>
      <div class="search-bar">
        <form method="get" action="" class="mb-3">
          <input type="text" name="q" class="form-control" placeholder="Search for pet..." value="{{ request.GET.q }}">
        </form>
      </div>
      <div id="clientResult" class=" text-center">

        {% if pet %}
             <div class="card owner-card m-3">
                        <div class="card-body">
                                  
                            <div class="searched-pet mb-2">
                                {% if pet.pet_profile %}
                                <div class="img-container mb-3">
                                <img src="{{ pet.pet_profile.url }}" alt="avatar" class="rounded-circle me-2" width="72" height="72" style="object-fit: cover;">
                                </div>
                                {% endif %}
                                <div class="">
                                <span class="badge badge-info">{{pet.dog_id}}</span>
                                </div>
                                <div>
                                <span class=""><strong>Name:</strong> {{ pet.name }} </span>
                                </div>
                                  <div class="">
                                <span class=""><strong>Age:</strong> {{pet.age}}</span>
                                </div>
                                 <div class="">
                                <span class=""><strong>Sex:</strong> {{pet.sex}}</span>
                                </div>
                                <div class="">
                                <span class=""><strong>Owner:</strong> {{pet.owner.first_name}} {{pet.owner.last_name}}</span>
                                </div>
                                 <div class="mb-3">
                                <span class=""><strong>Barangay:</strong> {{pet.barangay}}</span>
                                </div>
                                <div class="ml-auto action-btn">
                               <!-- <a href="{% url 'dog-profile' pet.id %}"><button class="view mb-2">View</button></a> -->
                               <a href="{% url 'add-service-record-form' pet.id %}"><button class="view">Select</button></a>
                               </div>
                            </div>
                        </div>
                   </div>
        {% endif %}
      </div>
    </div>

    <div class="w-100">
{% if selected_pet %}
         <div class="card owner-card selected-pet-container m-auto">
                        <div class="card-body  d-flex  justify-content-center w-100">
                            <div class=" align-items-center mb-2 text-center">
                              <div class="d-flex justify-content-center mb-3">
                                {% if selected_pet.pet_profile %}
                                <img src="{{ selected_pet.pet_profile.url }}" alt="avatar" class="rounded-circle me-2" width="40%"  style="object-fit: cover;">
                                {% endif %}
                                </div>
                               <div class="">
                                  <span class="badge badge-info">{{selected_pet.dog_id}}</span>
                                </div>
                                <span class=""><strong>Name:</strong> {{ selected_pet.name }} </span>
                                <div class="">
                                    <span class=""><strong>Age:</strong> {{ selected_pet.age }} </span>
                                </div>
                                 <div class="">
                                    <span class=""><strong>Sex:</strong> {{ selected_pet.sex }} </span>
                                </div>
                                 <div class="">
                                    <span class=""><strong>Owner:</strong> {{ selected_pet.owner.first_name }} {{ selected_pet.owner.last_name }} </span>
                                </div>
                                 <div class="">
                                    <span class=""><strong>Barangay:</strong> {{ selected_pet.barangay }} </span>
                                </div>
                            </div>
                        </div>
                   </div>
                         <form action="" method="POST" class="text-center mt-5">
        {% csrf_token %}
        <input type="hidden" name="selected_pet" value="{{selected_pet.id}}" required>
        <label for="service">Service:</label>
        <input list="service_list" id="service" name="service" class="form-control" placeholder="Type or select service">

        <datalist id="service_list">
            {% for s in services %}
                <option value="{{ s.name }}">
            {% endfor %}
        </datalist>
         <label for="date-administered">Date Administered:</label>
            <input type="date" id="date-administered" name="date-administered" class="form-control mb-4" required>

        <div class="d-flex justify-content-center">
        <button type="submit" class="btn submit-btn mb-2 mt-4 mr-0"><i class="fa-solid fa-check mr-2"></i> Add Record</button>
        
        </div>
       
      </form>

       <div class="d-flex justify-content-center">
          <a href="{% url 'add-service-record' %}">
          <button  class="btn cancel-btn mb-4 mt-0 mr-0"><i class="fas fa-xmark mr-2"></i> Cancel</button>
          </a>
        </div>
                   {% endif %}

      

    </div>
  

  </div>



  
<script>
  // Auto-remove messages after 5 seconds
  setTimeout(function() {
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => {
      alert.style.transition = "opacity 0.5s ease";
      alert.style.opacity = "0";
      setTimeout(() => alert.remove(), 500); // Remove from DOM after fade
    });
  }, 5000); // 5 seconds
</script>

{% endblock content %}